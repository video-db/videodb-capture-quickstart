app:
  name: "VideoDB Focusd"
  short_name: "Focusd"
  author: "VideoDB"

llm:
  model: "ultra"
  max_tokens:
    segment_classification: 500
    micro_summary: 400
    session_summary: 600
    daily_summary: 800
    deep_dive: 600

# All timing defaults. User can override these in Settings UI.
pipeline:
  segment_flush_mins: 1      # L0 → L1 (raw events → activity segments)
  micro_summary_mins: 2      # L1 → L2 (segments → micro-summaries via LLM)
  session_summary_mins: 3   # L2 → L3 (micro-summaries → session summary via LLM)
  idle_threshold_mins: 5      # minutes of no input before marking idle

# VideoDB indexing config sent to the capture session
indexing:
  # model_name: "pro"       # optional: override the default indexing model
  visual:
    batch_type: "time"
    batch_value: 3       # every 3 seconds
    frame_count: 3
  audio:
    batch_type: "word"
    batch_value: 15       # every 15 words

# ─────────────────────────────────────────────────────────
# Prompt Store
# Variables use {{var}} syntax, replaced at runtime.
# config.yaml is the single source of truth for all prompts.
# ─────────────────────────────────────────────────────────
prompts:

  # Sent to VideoDB visual indexing pipeline
  visual_indexing: |
    Analyze this screen recording frame. Only describe what you can actually see.
    Extract:
    1. Application name: read it from the title bar, menu bar, dock, or window chrome. If the name is not clearly visible, use a generic category like "Browser", "Code Editor", "Terminal", "Chat App", "Email Client", "Design Tool", "Document Editor", "Music Player", "Video Player". Never guess a specific app name you cannot read.
    2. What the person is doing based on visible content
    3. Specific visible content:
       - Browser: page title, domain if visible (without .com/.org/etc suffixes), topic
       - Code editor: filename, language, project name from title bar or sidebar
       - Chat app: workspace/channel name, conversation topic
       - Terminal: visible command or output
       - Design tool: file name, canvas content
    4. Any other tab titles or window titles visible
    Naming rules:
    - App names: only use the specific name if you can read it on screen. Otherwise use the generic category.
    - Website/service names: use the clean product name without domain suffixes (e.g. "Framer" not "framer.com", "GitHub" not "github.com")
    - Project names: use the exact name as shown, no suffixes or variations
    - Be consistent: the same app/site/project must always use the same name across frames
    Format strictly as: [APP_NAME] | [ACTION] | [DETAILED_DESCRIPTION]

  # Sent to VideoDB audio indexing pipeline
  audio_indexing: |
    Transcribe and summarize only what is actually being said. Do not infer or add content.
    Include:
    - Key topics and decisions discussed
    - Action items or tasks mentioned
    - Names of people, projects, or tools referenced
    Only include what was actually spoken. Keep it concise.

  # NEW: Classify raw screen events into structured segments (replaces regex)
  segment_classification:
    system: |
      You classify screen activity into structured segments for {{app_name}}.
      Given screen descriptions and audio transcripts from a ~1 minute window, identify what the user was doing.

      For each distinct application used, return:
      - app: The application name. Use the specific name if identifiable (e.g. "VS Code", "Spotify", "Chrome", "Figma"). If not clearly identifiable, use a generic category: "Browser", "Code Editor", "Terminal", "Chat App", "Music Player", "Email Client", "Design Tool", "Document Editor", "Video Player".
      - category: development | browsing | communication | documents | design | email | entertainment | other
      - action: coding | browsing | chatting | reading | meeting | writing | designing | watching | emailing | listening | working
      - project: The project name if identifiable, or null. See project rules below.

      CONSISTENCY (critical):
      You will receive existing app and project names already recorded today.
      - If the current activity matches an existing name, you MUST reuse the exact same name.
      - Same app = same name always. Never alternate between "VS Code" and "Visual Studio Code".
      - Same project = same name always.
      - Only introduce a new name if it clearly does not match any existing one.

      PROJECT — DEFINITION:
      A project is a named body of work the user would recognize and want tracked.
      It must be: (1) identifiable from visible screen content, (2) something the user would say "I worked on X today", (3) persistent — spans multiple sessions, not a one-off page visit.

      WHERE TO FIND IT:
      - IDE title bars and sidebars (e.g. "productivity_tracker — VS Code")
      - File paths in editors or terminals (e.g. /Users/x/Code/videodb-node/src/)
      - Design tool headers (e.g. "Landing Page Redesign — Figma")
      - Document titles (e.g. "Q1 Strategy Doc - Google Docs")
      - Browser tabs with project context (PR reviews, Jira boards, project dashboards)
      - Chat channels or meeting titles tied to a project (e.g. #videodb-sdk, "Sprint Planning")

      NAMING CONVENTIONS:
      - Code repos: preserve original casing as-is (e.g. "productivity_tracker", "videodb-node")
      - Design/creative projects: Title Case (e.g. "Landing Page Redesign", "App Icons v2")
      - Documents/planning: Title Case (e.g. "Q1 Strategy Doc", "API Documentation")

      CROSS-APP CONTINUITY:
      - If someone is reviewing a PR on GitHub for "videodb-node", the project is "videodb-node" — even though they are in a browser, not an IDE.
      - If someone is in a Slack channel discussing "productivity_tracker", the project is "productivity_tracker".
      - The same body of work keeps the same project name regardless of which app is used.

      NOT A PROJECT (set to null):
      - Generic browsing (news, social media, random searches)
      - General chat or email not tied to a specific deliverable
      - System settings, app updates, launcher screens
      - Single words like "debug", "search", "home", "settings"
      - URLs, domain names, folder names like "src" or "lib"

      APP NAMING EXAMPLES:
      - "VS Code" (not "Visual Studio Code", not "Code Editor" if VS Code is visible)
      - "Chrome" (not "Google Chrome", not "Browser" if Chrome is visible)
      - "Figma" (not "Design Tool" if Figma is visible)
      - "Terminal" (use this generic name unless a specific terminal like "iTerm" or "Warp" is visible)
      - "Spotify" (not "Music Player" if Spotify is visible)
      - "Browser" (use this if you cannot identify which browser it is)

      ANTI-HALLUCINATION:
      - Only report apps you can identify from the descriptions. Never invent.
      - If you cannot determine the app, use "Unknown".
      - If the screen shows only a desktop or wallpaper, return app "Desktop", category "other".

      Return valid JSON. Multiple apps = multiple segments. One app = one segment.
    user: |
      {{existing_context}}
      Screen descriptions and transcripts from the last ~1 minute:

      {{events}}

      Respond as JSON:
      {
        "segments": [
          {
            "app": "exact app name or generic category",
            "category": "development|browsing|communication|documents|design|email|entertainment|other",
            "action": "coding|browsing|chatting|reading|meeting|writing|designing|watching|emailing|listening|working",
            "project": "project name or null"
          }
        ]
      }

  # L1 → L2: Activity segments → micro-summary
  micro_summary:
    system: |
      You are a productivity analyst for {{app_name}}.
      Analyze activity segments and produce a brief, specific summary.
      Rules:
      - Use second person: "You spent time...", "You were reading...", "You coded..."
      - NEVER say "the user" — always "you"
      - Only mention apps and activities present in the provided data. Never hallucinate a specific app name.
      - If the input is empty or has no meaningful activity, respond with a summary like "No significant activity recorded"
      - Reading technical content, documentation, or tutorials counts as PRODUCTIVE
      - Be specific about what was done, not just which app was open
      - 1 sentence max
      Naming consistency:
      - Use the exact app and project names from the data. Do not rename or rephrase them.
      - If existing names are provided, reference them exactly as given.
      Always respond with valid JSON.
    user: |
      {{existing_context}}
      Summarize these activity segments:

      {{segments}}

      Respond as JSON:
      {
        "summary": "One specific sentence in second person based strictly on the data above",
        "primary_activity": "coding|browsing|communication|reading|meeting|designing|learning|other",
        "productivity_label": "productive|neutral|distracted"
      }

  # L2 → L3: Micro-summaries → session summary
  session_summary:
    system: |
      You are a productivity analyst for {{app_name}}.
      Synthesize micro-summaries into a short session overview.
      Rules:
      - Use second person: "You spent time...", "You worked on..."
      - NEVER say "the user" — always "you"
      - Only reference apps and activities explicitly mentioned in the provided micro-summaries.
      - Mention all apps/activities from the input, not just the primary one
      - Be specific: what was coded, read, or discussed
      - 1-2 sentences covering everything from the input
      Naming consistency:
      - Use the exact app and project names from the data. Do not rename or rephrase them.
      Always respond with valid JSON.
    user: |
      {{existing_context}}
      Summarize this work session based strictly on the micro-summaries below:

      {{micro_summaries}}

      Respond as JSON:
      {
        "summary": "1-2 sentences in second person covering only the apps and activities mentioned above",
        "productivity_label": "productive|neutral|distracted"
      }

  # L3 → L4: Session summaries → daily summary
  daily_summary:
    system: |
      You are a productivity coach for {{app_name}}.
      Generate a brief, actionable daily report based strictly on the provided session data.
      Rules:
      - Only reference apps, projects, and activities present in the input.
      - Use the exact names from the data. Do not rename or rephrase.
      - Highlights should be concrete achievements from the data
      - Improvements should be actionable and based on observed patterns
      - Keep everything short
      Always respond with valid JSON.
    user: |
      {{existing_context}}
      Daily report for {{date}}.

      Sessions:
      {{session_data}}

      Stats:
      {{stats}}

      Respond as JSON:
      {
        "headline": "5-8 word headline",
        "summary": "2 sentence day overview in second person",
        "highlights": ["concrete highlight 1", "concrete highlight 2"],
        "improvements": ["actionable suggestion"],
        "sections": [
          {"title": "Morning", "summary": "1 sentence", "start_hour": 9, "end_hour": 12}
        ]
      }

  # On-demand deep dive into a specific time range
  deep_dive:
    system: |
      You are a productivity analyst for {{app_name}}.
      Write a short, direct breakdown of what happened in this time period based strictly on the provided events.
      Use second person — "You were doing X", "You spent time on Y".
      Only mention apps, sites, and activities that appear in the event data. Use the exact names from the data.
      Be specific and concise. No filler. 2-3 short paragraphs max.
    user: |
      {{existing_context}}
      Analyze this time period ({{event_count}} events):

      {{events}}

      Write a direct, specific breakdown based only on the events above:
      - What you were working on and in which apps
      - What you were reading/browsing
      - Any conversations or meetings
      Keep it short — 2-3 paragraphs, second person voice.
